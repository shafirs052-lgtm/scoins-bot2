<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCoinS PRO - –ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ –º–æ–Ω–µ—Ç—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #1a1d29;
            min-height: 100vh;
            padding: 16px;
            line-height: 1.6;
        }
        
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
        }
        
        /* –°–û–í–†–ï–ú–ï–ù–ù–´–ô –•–ï–î–ï–† */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .balance-card {
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #667eea, #5a6fd8);
            color: white;
            padding: 14px 20px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* –°–¢–ò–õ–¨–ù–û–ï –ú–ï–ù–Æ */
        .menu {
            display: flex;
            gap: 8px;
            margin-bottom: 0;
            flex-wrap: wrap;
        }
        
        .menu-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 14px 16px;
            border-radius: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 120px;
            font-size: 14px;
            color: #4b5563;
        }
        
        .menu-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        
        .menu-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }
        
        /* –°–û–í–†–ï–ú–ï–ù–ù–´–ï –°–ï–ö–¶–ò–ò */
        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }
        
        .section.active { 
            display: block; 
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .section h2 { 
            text-align: center; 
            margin-bottom: 28px; 
            color: #1a1d29;
            font-size: 24px;
            font-weight: 600;
        }
        
        /* –ö–ê–†–¢–û–ß–ö–ò –ú–û–ù–ï–¢ - –ù–ï–û–ú–û–†–§–ò–ó–ú */
        .coins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
        }
        
        .coin-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .coin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s;
        }
        
        .coin-card:hover::before {
            left: 100%;
        }
        
        .coin-card:hover { 
            transform: translateY(-6px);
            box-shadow: 
                0 12px 30px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }
        
        .coin-icon { 
            font-size: 64px; 
            margin-bottom: 16px; 
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }
        
        .coin-name { 
            font-weight: 600; 
            margin-bottom: 12px; 
            font-size: 18px; 
            color: #1a1d29;
        }
        
        .coin-rarity {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .rarity-common { 
            background: linear-gradient(135deg, #6b7280, #9ca3af);
            box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);
        }
        .rarity-rare { 
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        .rarity-epic { 
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }
        .rarity-legendary { 
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        
        .coin-price {
            font-size: 20px;
            font-weight: 700;
            color: #f59e0b;
            margin: 16px 0;
            text-shadow: 0 2px 4px rgba(245, 158, 11, 0.2);
        }
        
        /* –°–û–í–†–ï–ú–ï–ù–ù–´–ï –ö–ù–û–ü–ö–ò */
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 15px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover { 
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled { 
            background: #d1d5db; 
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #9ca3af);
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }
        
        .btn-small {
            padding: 10px 16px;
            font-size: 13px;
            width: auto;
        }

        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .stat-card.large {
            padding: 28px;
        }
        
        .stat-card h3 {
            margin-bottom: 20px;
            color: #1a1d29;
            font-size: 18px;
            font-weight: 600;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }

        /* –ü–õ–ê–¢–ï–ñ–ò */
        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }
        
        .payment-option {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .payment-option:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        
        .payment-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.2);
        }
        
        .payment-option .icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .payment-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 16px;
            color: #1a1d29;
        }
        
        .payment-desc {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.5;
        }

        .amount-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .amount-btn {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e5e7eb;
            padding: 16px 12px;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            color: #4b5563;
        }
        
        .amount-btn:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
            transform: translateY(-2px);
        }
        
        .amount-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .custom-amount {
            margin: 24px 0;
        }
        
        .custom-amount label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: #374151;
        }
        
        .custom-amount input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 16px;
            transition: all 0.3s;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .custom-amount input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .payment-btn {
            margin-top: 24px;
            font-size: 16px;
            padding: 18px;
        }

        /* –†–´–ù–û–ö */
        .marketplace-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 28px;
        }
        
        .sell-form {
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
            padding: 24px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        
        .marketplace-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .marketplace-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        
        .marketplace-actions {
            display: flex;
            gap: 8px;
            margin-left: auto;
        }
        
        .seller-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            font-size: 13px;
            color: #6b7280;
        }
        
        .seller-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: 600;
        }
        
        .user-rating {
            display: inline-block;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ò –ú–û–î–ê–õ–ö–ò */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 16px 24px;
            border-radius: 16px;
            font-weight: 600;
            z-index: 1000;
            display: none;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .notification.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .modal-actions .btn {
            flex: 1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 14px;
            font-size: 16px;
            transition: all 0.3s;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .address-box {
            background: #1f2937;
            color: white;
            padding: 16px;
            border-radius: 14px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            margin: 12px 0;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .address-box:hover {
            background: #374151;
            transform: translateY(-2px);
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 768px) {
            body { padding: 12px; }
            .header-top { flex-direction: column; gap: 16px; text-align: center; }
            .coins-grid { grid-template-columns: 1fr; }
            .menu { flex-direction: column; }
            .section { padding: 20px; }
            .coin-card { padding: 20px; }
            .stats-grid { grid-template-columns: 1fr; }
            .payment-options { grid-template-columns: 1fr; }
            .amount-buttons { grid-template-columns: repeat(2, 1fr); }
            .marketplace-item { flex-direction: column; text-align: center; }
            .marketplace-actions { margin-left: 0; margin-top: 16px; width: 100%; justify-content: center; }
            .modal-actions { flex-direction: column; }
            .modal-content { padding: 24px; }
        }
        
        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes slideUp {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: scale(0.9) translateY(-20px); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-top">
                <h1>ü™ô SCoinS PRO</h1>
                <div class="balance-card">
                    <span id="balance">100</span>
                    <span>‚≠ê</span>
                </div>
            </div>
            
            <div class="menu">
                <button class="menu-btn active" onclick="showSection('shop')">üè™ –ú–∞–≥–∞–∑–∏–Ω</button>
                <button class="menu-btn" onclick="showSection('collection')">üéí –ö–æ–ª–ª–µ–∫—Ü–∏—è</button>
                <button class="menu-btn" onclick="showSection('marketplace')">üîÑ –†—ã–Ω–æ–∫</button>
                <button class="menu-btn" onclick="showSection('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                <button class="menu-btn" onclick="showSection('topup')">üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
            </div>
        </header>

        <!-- –ú–ê–ì–ê–ó–ò–ù –ú–û–ù–ï–¢ -->
        <section id="shop" class="section active">
            <h2>üè™ –ú–∞–≥–∞–∑–∏–Ω –º–æ–Ω–µ—Ç</h2>
            <div class="coins-grid" id="coinsGrid"></div>
        </section>

        <!-- –ö–û–õ–õ–ï–ö–¶–ò–Ø -->
        <section id="collection" class="section">
            <h2>üéí –í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è</h2>
            <div id="collectionGrid"></div>
        </section>

        <!-- –û–ù–õ–ê–ô–ù-–†–´–ù–û–ö -->
        <section id="marketplace" class="section">
            <h2>üîÑ –¢–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥–∫–∞</h2>
            
            <div class="marketplace-controls">
                <div class="sell-form">
                    <h3>üí∞ –ü—Ä–æ–¥–∞—Ç—å —Å–≤–æ–∏ –º–æ–Ω–µ—Ç—ã</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–Ω–µ—Ç—É –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–≤–æ—é —Ü–µ–Ω—É</p>
                    <button class="btn" onclick="showSection('collection')">
                        üì¶ –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
                    </button>
                </div>
            </div>
            
            <h3 style="margin-bottom: 20px;">üè™ –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h3>
            <div id="marketplaceContent"></div>
        </section>

        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <section id="stats" class="section">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            
            <div class="stats-grid">
                <div class="stat-card large">
                    <h3>üìà –ú–æ—è –∫–æ–ª–ª–µ–∫—Ü–∏—è</h3>
                    <div class="stat-item">
                        <span>–ë–∞–ª–∞–Ω—Å:</span>
                        <strong id="statBalance">0 ‚≠ê</strong>
                    </div>
                    <div class="stat-item">
                        <span>–í—Å–µ–≥–æ –º–æ–Ω–µ—Ç:</span>
                        <strong id="statTotalCoins">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–æ–Ω–µ—Ç:</span>
                        <strong id="statUniqueCoins">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                        <strong id="statTotalValue">0 ‚≠ê</strong>
                    </div>
                </div>
                
                <div class="stat-card large">
                    <h3>üí∞ –ú–æ–∏ —Å–¥–µ–ª–∫–∏</h3>
                    <div class="stat-item">
                        <span>–ü—Ä–æ–¥–∞–Ω–æ –º–æ–Ω–µ—Ç:</span>
                        <strong id="statSold">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–ö—É–ø–ª–µ–Ω–æ —Å —Ä—ã–Ω–∫–∞:</span>
                        <strong id="statBought">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:</span>
                        <strong id="statTransactions">0</strong>
                    </div>
                </div>
                
                <div class="stat-card large">
                    <h3>üåê –í–µ—Å—å —Ä—ã–Ω–æ–∫</h3>
                    <div class="stat-item">
                        <span>–í—Å–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:</span>
                        <strong id="marketTotal">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                        <strong id="marketValue">0 ‚≠ê</strong>
                    </div>
                    <div class="stat-item">
                        <span>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:</span>
                        <strong id="marketAverage">0 ‚≠ê</strong>
                    </div>
                </div>
            </div>
        </section>

        <!-- –ü–û–ü–û–õ–ù–ï–ù–ò–ï –ë–ê–õ–ê–ù–°–ê -->
        <section id="topup" class="section">
            <h2>üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h2>
            
            <div class="payment-options">
                <div class="payment-option selected" onclick="selectPayment('stars')">
                    <div class="icon">‚≠ê</div>
                    <div class="payment-title">Telegram Stars</div>
                    <div class="payment-desc">
                        1 –∑–≤–µ–∑–¥–∞ = 1 ‚≠ê –≤ –∏–≥—Ä–µ<br>
                        ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
                    </div>
                </div>
                
                <div class="payment-option" onclick="selectPayment('ton')">
                    <div class="icon">‚ö°</div>
                    <div class="payment-title">TON</div>
                    <div class="payment-desc">
                        1 TON = 150 ‚≠ê<br>
                        üîÑ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                    </div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 16px;">–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É:</h3>
            <div class="amount-buttons">
                <button class="amount-btn" onclick="selectAmount(50)">50 ‚≠ê</button>
                <button class="amount-btn" onclick="selectAmount(100)">100 ‚≠ê</button>
                <button class="amount-btn selected" onclick="selectAmount(250)">250 ‚≠ê</button>
                <button class="amount-btn" onclick="selectAmount(500)">500 ‚≠ê</button>
                <button class="amount-btn" onclick="selectAmount(1000)">1,000 ‚≠ê</button>
                <button class="amount-btn" onclick="selectAmount(5000)">5,000 ‚≠ê</button>
            </div>
            
            <div class="custom-amount">
                <label>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —Å—É–º–º—É:</label>
                <input type="number" id="customAmount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" min="50" max="50000">
            </div>
            
            <button class="btn payment-btn" onclick="startPayment()">
                üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
            </button>
        </section>
    </div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification"></div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <h3 id="paymentTitle">üí≥ –û–ø–ª–∞—Ç–∞</h3>
            <div id="paymentContent"></div>
        </div>
    </div>
    
    <div class="modal" id="sellModal">
        <div class="modal-content">
            <h3>üí∞ –ü—Ä–æ–¥–∞—Ç—å –º–æ–Ω–µ—Ç—É</h3>
            <div id="sellCoinInfo"></div>
            <div class="form-group">
                <label>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (–≤ –∑–≤–µ–∑–¥–∞—Ö):</label>
                <input type="number" id="sellPrice" placeholder="–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É" min="1">
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="confirmSell()">‚úÖ –í—ã—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∂—É</button>
                <button class="btn btn-secondary" onclick="closeModal('sellModal')">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´
        const CONFIG = {
            VERSION: '6.0.0',
            GAME_NAME: 'SCoinS PRO',
            SERVER_URL: window.location.origin,
            
            STARTING_BALANCE: 100,
            MIN_TOPUP_AMOUNT: 50,
            MAX_TOPUP_AMOUNT: 50000,
            
            PAYMENT_METHODS: {
                STARS: { name: 'Telegram Stars', rate: 1 },
                TON: { name: 'TON', rate: 150 }
            },
            
            PAYMENT_ADDRESSES: {
                STARS: 'TG_BOT_USERNAME',
                TON: 'UQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
            },
            
            MARKETPLACE: {
                COMMISSION: 0.05,
                MIN_SELL_PRICE: 1,
                MAX_ITEMS_PER_USER: 10
            },
            
            COINS: [
                {id: 1, name: "–ë—Ä–æ–Ω–∑–æ–≤—ã–π SCoin", icon: "üü´", price: 10, rarity: "common", description: "–ë–∞–∑–æ–≤–∞—è –º–æ–Ω–µ—Ç–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏", edition: "Standard"},
                {id: 2, name: "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π SCoin", icon: "‚ö™", price: 25, rarity: "rare", description: "–ú–æ–Ω–µ—Ç–∞ –∏–∑ —á–∏—Å—Ç–æ–≥–æ —Å–µ—Ä–µ–±—Ä–∞", edition: "Premium"},
                {id: 3, name: "–ó–æ–ª–æ—Ç–æ–π SCoin", icon: "üü°", price: 50, rarity: "epic", description: "–†–æ—Å–∫–æ—à–Ω–∞—è –∑–æ–ª–æ—Ç–∞—è –º–æ–Ω–µ—Ç–∞", edition: "Deluxe"},
                {id: 4, name: "–ü–ª–∞—Ç–∏–Ω–æ–≤—ã–π SCoin", icon: "üîò", price: 100, rarity: "legendary", description: "–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –ø–ª–∞—Ç–∏–Ω–æ–≤–∞—è –º–æ–Ω–µ—Ç–∞", edition: "Exclusive"},
                {id: 5, name: "–ö—Ä–∏—Å—Ç–∞–ª—å–Ω—ã–π SCoin", icon: "üíé", price: 150, rarity: "legendary", description: "–ú–æ–Ω–µ—Ç–∞ –∏–∑ —á–∏—Å—Ç–æ–≥–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞", edition: "Crystal"},
                {id: 6, name: "–î—Ä–µ–≤–Ω–∏–π SCoin", icon: "üè∫", price: 75, rarity: "epic", description: "–ú–æ–Ω–µ—Ç–∞ –¥—Ä–µ–≤–Ω–µ–π —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏", edition: "Ancient"},
                {id: 7, name: "–û–≥–Ω–µ–Ω–Ω—ã–π SCoin", icon: "üî•", price: 80, rarity: "epic", description: "–ì–æ—Ä—è—á–∞—è –º–æ–Ω–µ—Ç–∞ –∏–∑ –≤—É–ª–∫–∞–Ω–∞", edition: "Fire"},
                {id: 8, name: "–õ–µ–¥—è–Ω–æ–π SCoin", icon: "‚ùÑÔ∏è", price: 85, rarity: "epic", description: "–•–æ–ª–æ–¥–Ω–∞—è –º–æ–Ω–µ—Ç–∞ —Å –ª–µ–¥–Ω–∏–∫–∞", edition: "Ice"},
                {id: 9, name: "–†–∞–¥—É–∂–Ω—ã–π SCoin", icon: "üåà", price: 200, rarity: "legendary", description: "–†–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω–∞—è –≤–æ–ª—à–µ–±–Ω–∞—è –º–æ–Ω–µ—Ç–∞", edition: "Rainbow"},
                {id: 10, name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π SCoin", icon: "üöÄ", price: 175, rarity: "legendary", description: "–ú–æ–Ω–µ—Ç–∞ —Å –º–µ—Ç–µ–æ—Ä–∏—Ç–Ω–æ–π –ø—ã–ª—å—é", edition: "Space"},
                {id: 11, name: "–ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π SCoin", icon: "üëª", price: 60, rarity: "rare", description: "–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –º–æ–Ω–µ—Ç–∞", edition: "Ghost"},
                {id: 12, name: "–î—Ä–∞–∫–æ–Ω–∏–π SCoin", icon: "üêâ", price: 250, rarity: "legendary", description: "–ú–æ–Ω–µ—Ç–∞ –∏–∑ –¥—Ä–∞–∫–æ–Ω—å–µ–π —á–µ—à—É–∏", edition: "Dragon"}
            ],
            
            RARITIES: {
                common: { name: "–û–±—ã—á–Ω–∞—è", color: "#6b7280", multiplier: 1 },
                rare: { name: "–†–µ–¥–∫–∞—è", color: "#3b82f6", multiplier: 2 },
                epic: { name: "–≠–ø–∏—á–µ—Å–∫–∞—è", color: "#8b5cf6", multiplier: 3 },
                legendary: { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è", color: "#f59e0b", multiplier: 5 }
            }
        };

        // –û–°–ù–û–í–ù–û–ô –ö–õ–ê–°–° –ò–ì–†–´
        class GameEngine {
            constructor() {
                this.balance = CONFIG.STARTING_BALANCE;
                this.collection = [];
                this.stats = {
                    totalCoins: 0,
                    totalValue: 0,
                    totalSold: 0,
                    totalBought: 0,
                    totalTransactions: 0
                };
                this.userId = this.getUserId();
                this.userName = this.getUserName();
                this.marketplace = [];
                
                this.init();
            }
            
            async init() {
                console.log(`üéÆ ${CONFIG.GAME_NAME} v${CONFIG.VERSION} –∑–∞–ø—É—â–µ–Ω!`);
                
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.expand();
                    window.Telegram.WebApp.ready();
                }
                
                this.loadGameData();
                await this.loadMarketplace();
                this.renderAll();
            }
            
            loadGameData() {
                try {
                    const saved = localStorage.getItem('scoins_pro_save');
                    if (saved) {
                        const data = JSON.parse(saved);
                        this.balance = data.balance || CONFIG.STARTING_BALANCE;
                        this.collection = data.collection || [];
                        this.stats = data.stats || this.stats;
                    }
                } catch (e) {
                    console.log('–ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
                }
            }
            
            saveGameData() {
                const data = {
                    balance: this.balance,
                    collection: this.collection,
                    stats: this.stats,
                    version: CONFIG.VERSION,
                    lastSave: Date.now()
                };
                localStorage.setItem('scoins_pro_save', JSON.stringify(data));
            }
            
            async loadMarketplace() {
                try {
                    const response = await fetch(`${CONFIG.SERVER_URL}/api/marketplace`);
                    if (response.ok) {
                        this.marketplace = await response.json();
                    } else {
                        throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    }
                } catch (error) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä—ã–Ω–∫–∞:', error);
                }
            }
            
            // –ú–ê–ì–ê–ó–ò–ù –ú–û–ù–ï–¢
            renderShop() {
                const grid = document.getElementById('coinsGrid');
                if (!grid) return;
                
                grid.innerHTML = CONFIG.COINS.map(coin => {
                    const owned = this.collection.some(c => c.id === coin.id);
                    const canBuy = this.balance >= coin.price && !owned;
                    const rarityInfo = this.getRarityInfo(coin.rarity);
                    
                    return `
                        <div class="coin-card" onclick="showCoinInfo(${coin.id})">
                            <div class="coin-icon">${coin.icon}</div>
                            <div class="coin-name">${coin.name}</div>
                            <div class="coin-rarity rarity-${coin.rarity}">
                                ${rarityInfo.name}
                            </div>
                            <div class="coin-price">${coin.price} ‚≠ê</div>
                            <button class="btn" onclick="event.stopPropagation(); buyCoin(${coin.id})" 
                                    ${!canBuy ? 'disabled' : ''}>
                                ${owned ? '‚úÖ –í –∫–æ–ª–ª–µ–∫—Ü–∏–∏' : canBuy ? '–ö—É–ø–∏—Ç—å' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ'}
                            </button>
                        </div>
                    `;
                }).join('');
            }
            
            buyCoin(coinId) {
                const coin = CONFIG.COINS.find(c => c.id === coinId);
                if (!coin) {
                    this.showNotification('–ú–æ–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return false;
                }
                
                if (this.collection.some(c => c.id === coinId)) {
                    this.showNotification('–≠—Ç–∞ –º–æ–Ω–µ—Ç–∞ —É–∂–µ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏', 'error');
                    return false;
                }
                
                if (this.balance < coin.price) {
                    this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥', 'error');
                    return false;
                }
                
                this.balance -= coin.price;
                
                const purchasedCoin = {
                    ...coin,
                    purchaseId: 'shop_' + Date.now() + '_' + Math.random().toString(36).substring(2, 11),
                    purchaseDate: Date.now(),
                    purchasePrice: coin.price
                };
                
                this.collection.push(purchasedCoin);
                this.stats.totalTransactions++;
                
                this.saveGameData();
                this.calculateStats();
                this.renderAll();
                
                this.showNotification(`üéâ –ö—É–ø–ª–µ–Ω–æ: ${coin.name} –∑–∞ ${coin.price} ‚≠ê!`);
                return true;
            }
            
            // –ö–û–õ–õ–ï–ö–¶–ò–Ø
            renderCollection() {
                const grid = document.getElementById('collectionGrid');
                if (!grid) return;
                
                if (this.collection.length === 0) {
                    grid.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #6b7280;">
                            <div style="font-size: 3em; margin-bottom: 12px;">üéí</div>
                            <p>–ö–æ–ª–ª–µ–∫—Ü–∏—è –ø—É—Å—Ç–∞</p>
                            <p style="font-size: 0.9em; margin-top: 8px;">–ö—É–ø–∏—Ç–µ –ø–µ—Ä–≤—É—é –º–æ–Ω–µ—Ç—É –≤ –º–∞–≥–∞–∑–∏–Ω–µ!</p>
                            <button class="btn" onclick="showSection('shop')" style="margin-top: 16px;">
                                üè™ –ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div style="display: flex; flex-wrap: wrap; gap: 12px;">';
                this.collection.forEach((coin, index) => {
                    html += `
                        <div class="coin-card" style="width: 140px;" onclick="showCoinInfo(${coin.id})">
                            <div class="coin-icon">${coin.icon}</div>
                            <div style="font-weight: bold; font-size: 0.9em;">${coin.name}</div>
                            <div style="font-size: 0.7em; color: #6b7280;">${this.getRarityInfo(coin.rarity).name}</div>
                            <div style="color: #f59e0b; font-weight: bold; margin: 8px 0;">
                                ${coin.price} ‚≠ê
                            </div>
                            <button class="btn btn-secondary btn-small" 
                                    onclick="event.stopPropagation(); sellCoin(${index})">
                                üí∞ –ü—Ä–æ–¥–∞—Ç—å
                            </button>
                        </div>
                    `;
                });
                html += '</div>';
                
                grid.innerHTML = html;
            }
            
            // –û–ù–õ–ê–ô–ù-–†–´–ù–û–ö
            renderMarketplace() {
                const content = document.getElementById('marketplaceContent');
                if (!content) return;
                
                if (this.marketplace.length === 0) {
                    content.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #6b7280;">
                            <div style="font-size: 3em; margin-bottom: 12px;">üîÑ</div>
                            <p>–ù–∞ —Ä—ã–Ω–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π</p>
                            <p style="font-size: 0.9em; margin-top: 8px;">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –≤—ã—Å—Ç–∞–≤–∏—Ç –º–æ–Ω–µ—Ç—É –Ω–∞ –ø—Ä–æ–¥–∞–∂—É!</p>
                        </div>
                    `;
                    return;
                }
                
                const sortedMarketplace = [...this.marketplace].sort((a, b) => b.timestamp - a.timestamp);
                
                content.innerHTML = sortedMarketplace.map((item, index) => {
                    const isOwnItem = item.sellerId === this.userId;
                    const canBuy = this.balance >= item.price && !isOwnItem;
                    const rarityInfo = this.getRarityInfo(item.coin.rarity);
                    const timeAgo = this.getTimeAgo(item.timestamp);
                    
                    return `
                        <div class="marketplace-item">
                            <div style="font-size: 2.5em; cursor: pointer;" 
                                 onclick="showCoinInfo(${item.coin.id})">
                                ${item.coin.icon}
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold; font-size: 1.1em; cursor: pointer;"
                                     onclick="showCoinInfo(${item.coin.id})">
                                    ${item.coin.name}
                                </div>
                                <div style="color: #6b7280; font-size: 0.9em;">
                                    <span class="coin-rarity rarity-${item.coin.rarity}" 
                                          style="font-size: 0.8em; padding: 2px 8px;">
                                        ${rarityInfo.name}
                                    </span>
                                    ‚Ä¢ ${item.coin.edition}
                                </div>
                                <div class="seller-info">
                                    <div class="seller-avatar">${item.sellerName.charAt(0)}</div>
                                    <span>${item.sellerName}</span>
                                    <span class="user-rating">‚≠ê ${item.sellerRating}</span>
                                    <span style="color: #9ca3af; font-size: 0.8em;">‚Ä¢ ${timeAgo}</span>
                                </div>
                                <div style="color: #f59e0b; font-weight: bold; font-size: 1.2em; margin-top: 4px;">
                                    ${item.price} ‚≠ê
                                </div>
                            </div>
                            <div class="marketplace-actions">
                                ${isOwnItem ? `
                                    <button class="btn btn-secondary btn-small" 
                                            onclick="cancelSale('${item.globalId}')">
                                        ‚ùå –°–Ω—è—Ç—å
                                    </button>
                                ` : `
                                    <button class="btn btn-small" 
                                            onclick="buyFromMarketplace('${item.globalId}')" 
                                            ${!canBuy ? 'disabled' : ''}>
                                        –ö—É–ø–∏—Ç—å
                                    </button>
                                `}
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            sellCoin(collectionIndex) {
                if (collectionIndex < 0 || collectionIndex >= this.collection.length) {
                    this.showNotification('–ú–æ–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return;
                }
                
                window.currentSellCoin = this.collection[collectionIndex];
                window.currentSellIndex = collectionIndex;
                
                const priceRange = this.calculateMarketPrice(
                    window.currentSellCoin.price, 
                    window.currentSellCoin.rarity
                );
                
                const content = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em;">${window.currentSellCoin.icon}</div>
                        <div style="font-weight: bold; font-size: 1.2em;">${window.currentSellCoin.name}</div>
                        <div style="color: #6b7280;">${window.currentSellCoin.description}</div>
                        <div style="margin-top: 12px; color: #f59e0b; font-weight: bold;">
                            –ò—Å—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞: ${window.currentSellCoin.price} ‚≠ê
                        </div>
                        <div style="font-size: 0.9em; color: #6b7280; margin-top: 8px;">
                            –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞: ${priceRange.minPrice} - ${priceRange.maxPrice} ‚≠ê
                        </div>
                    </div>
                `;
                
                document.getElementById('sellCoinInfo').innerHTML = content;
                document.getElementById('sellPrice').value = Math.max(
                    CONFIG.MARKETPLACE.MIN_SELL_PRICE,
                    Math.floor(window.currentSellCoin.price * 1.2)
                );
                
                this.showModal('sellModal');
            }
            
            async confirmSell() {
                if (!window.currentSellCoin) {
                    this.showNotification('–ú–æ–Ω–µ—Ç–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞', 'error');
                    return;
                }
                
                const priceInput = document.getElementById('sellPrice');
                const price = parseInt(priceInput.value);
                
                if (isNaN(price) || price < CONFIG.MARKETPLACE.MIN_SELL_PRICE) {
                    this.showNotification(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: ${CONFIG.MARKETPLACE.MIN_SELL_PRICE} ‚≠ê`, 'error');
                    return;
                }
                
                const userItemsCount = this.marketplace.filter(item => 
                    item.sellerId === this.userId
                ).length;
                
                if (userItemsCount >= CONFIG.MARKETPLACE.MAX_ITEMS_PER_USER) {
                    this.showNotification(`–õ–∏–º–∏—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π: ${CONFIG.MARKETPLACE.MAX_ITEMS_PER_USER}`, 'error');
                    return;
                }
                
                const collectionIndex = this.collection.findIndex(coin => 
                    coin.purchaseId === window.currentSellCoin.purchaseId
                );
                
                if (collectionIndex === -1) {
                    this.showNotification('–ú–æ–Ω–µ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏', 'error');
                    return;
                }
                
                const marketplaceItem = {
                    coin: { ...window.currentSellCoin },
                    price: price,
                    sellerId: this.userId,
                    sellerName: this.userName,
                    sellerRating: this.getUserRating(),
                    timestamp: Date.now()
                };
                
                try {
                    const response = await fetch(`${CONFIG.SERVER_URL}/api/marketplace`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(marketplaceItem)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        marketplaceItem.globalId = result.item.globalId;
                        this.marketplace.push(marketplaceItem);
                        this.collection.splice(collectionIndex, 1);
                        
                        this.saveGameData();
                        this.renderAll();
                        
                        this.closeModal('sellModal');
                        this.showNotification('‚úÖ –ú–æ–Ω–µ—Ç–∞ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É!');
                    } else {
                        this.showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
                    }
                } catch (error) {
                    this.showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                }
                
                window.currentSellCoin = null;
                window.currentSellIndex = null;
            }
            
            async buyFromMarketplace(globalId) {
                const itemIndex = this.marketplace.findIndex(item => item.globalId === globalId);
                if (itemIndex === -1) {
                    this.showNotification('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
                    return;
                }
                
                const item = this.marketplace[itemIndex];
                
                if (item.sellerId === this.userId) {
                    this.showNotification('–ù–µ–ª—å–∑—è –∫—É–ø–∏—Ç—å —Å–≤–æ—é –∂–µ –º–æ–Ω–µ—Ç—É', 'error');
                    return;
                }
                
                if (this.balance < item.price) {
                    this.showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥', 'error');
                    return;
                }
                
                const commission = Math.floor(item.price * CONFIG.MARKETPLACE.COMMISSION);
                const finalPrice = item.price - commission;
                
                this.balance -= item.price;
                this.stats.totalBought++;
                this.stats.totalTransactions++;
                
                const purchasedCoin = {
                    ...item.coin,
                    purchaseId: `market_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`,
                    purchasedFrom: item.sellerName,
                    purchasePrice: item.price,
                    purchaseDate: Date.now()
                };
                
                this.collection.push(purchasedCoin);
                
                try {
                    const response = await fetch(`${CONFIG.SERVER_URL}/api/marketplace/${globalId}?userId=${this.userId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        this.marketplace.splice(itemIndex, 1);
                    }
                } catch (error) {
                    console.log('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞');
                    this.marketplace.splice(itemIndex, 1);
                }
                
                this.saveGameData();
                this.renderAll();
                
                this.showNotification(
                    `üéâ –ö—É–ø–ª–µ–Ω–æ: ${item.coin.name} –∑–∞ ${item.price} ‚≠ê! ` +
                    `(–∫–æ–º–∏—Å—Å–∏—è: ${commission} ‚≠ê)`
                );
            }
            
            async cancelSale(globalId) {
                const itemIndex = this.marketplace.findIndex(item => item.globalId === globalId);
                if (itemIndex === -1) {
                    this.showNotification('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
                    return;
                }
                
                const item = this.marketplace[itemIndex];
                
                if (item.sellerId === this.userId) {
                    try {
                        const response = await fetch(`${CONFIG.SERVER_URL}/api/marketplace/${globalId}?userId=${this.userId}`, {
                            method: 'DELETE'
                        });
                        
                        if (response.ok) {
                            this.collection.push(item.coin);
                            this.marketplace.splice(itemIndex, 1);
                            
                            this.saveGameData();
                            this.renderAll();
                            
                            this.showNotification('‚úÖ –ü—Ä–æ–¥–∞–∂–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞, –º–æ–Ω–µ—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é');
                        }
                    } catch (error) {
                        this.showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                    }
                }
            }
            
            // –°–¢–ê–¢–ò–°–¢–ò–ö–ê
            calculateStats() {
                this.stats.totalCoins = this.collection.length;
                this.stats.totalValue = this.collection.reduce((sum, coin) => sum + coin.price, 0);
                this.stats.uniqueCoins = new Set(this.collection.map(c => c.id)).size;
                
                document.getElementById('statBalance').textContent = this.balance + ' ‚≠ê';
                document.getElementById('statTotalCoins').textContent = this.stats.totalCoins;
                document.getElementById('statUniqueCoins').textContent = this.stats.uniqueCoins;
                document.getElementById('statTotalValue').textContent = this.stats.totalValue + ' ‚≠ê';
                document.getElementById('statSold').textContent = this.stats.totalSold;
                document.getElementById('statBought').textContent = this.stats.totalBought;
                document.getElementById('statTransactions').textContent = this.stats.totalTransactions;
            }
            
            updateMarketStats() {
                const totalItems = this.marketplace.length;
                const totalValue = this.marketplace.reduce((sum, item) => sum + item.price, 0);
                const averagePrice = totalItems > 0 ? Math.floor(totalValue / totalItems) : 0;
                
                document.getElementById('marketTotal').textContent = totalItems;
                document.getElementById('marketValue').textContent = totalValue + ' ‚≠ê';
                document.getElementById('marketAverage').textContent = averagePrice + ' ‚≠ê';
            }
            
            updateBalance() {
                const balanceElement = document.getElementById('balance');
                if (balanceElement) balanceElement.textContent = this.balance;
            }
            
            renderAll() {
                this.renderShop();
                this.renderCollection();
                this.renderMarketplace();
                this.updateBalance();
                this.calculateStats();
                this.updateMarketStats();
            }
            
            // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
            getUserId() {
                const tg = window.Telegram?.WebApp;
                return tg?.initDataUnsafe?.user?.id || 'user_' + Math.random().toString(36).substring(2, 10);
            }
            
            getUserName() {
                const tg = window.Telegram?.WebApp;
                const user = tg?.initDataUnsafe?.user;
                if (user) {
                    return user.first_name || user.username || '–ê–Ω–æ–Ω–∏–º';
                }
                return '–ò–≥—Ä–æ–∫';
            }
            
            getUserRating() {
                return (4.5 + Math.random() * 0.5).toFixed(1);
            }
            
            getRarityInfo(rarity) {
                return CONFIG.RARITIES[rarity] || CONFIG.RARITIES.common;
            }
            
            calculateMarketPrice(originalPrice, rarity) {
                const rarityMultiplier = CONFIG.RARITIES[rarity].multiplier;
                const minPrice = Math.max(1, Math.floor(originalPrice * 0.5));
                const maxPrice = Math.floor(originalPrice * rarityMultiplier * 3);
                return { minPrice, maxPrice };
            }
            
            getTimeAgo(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);
                
                if (days > 0) return `${days} –¥. –Ω–∞–∑–∞–¥`;
                if (hours > 0) return `${hours} —á. –Ω–∞–∑–∞–¥`;
                if (minutes > 0) return `${minutes} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
                return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            }
            
            showNotification(message, type = 'success') {
                const notif = document.getElementById('notification');
                if (!notif) return;
                
                notif.textContent = message;
                notif.className = `notification ${type}`;
                notif.style.display = 'block';
                
                setTimeout(() => {
                    notif.style.display = 'none';
                }, 5000);
            }
            
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) modal.style.display = 'flex';
            }
            
            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) modal.style.display = 'none';
            }
        }

        // –°–ò–°–¢–ï–ú–ê –ü–õ–ê–¢–ï–ñ–ï–ô
        class PaymentSystem {
            constructor() {
                this.selectedPayment = 'stars';
                this.selectedAmount = 250;
                this.currentPaymentId = null;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                const customAmountInput = document.getElementById('customAmount');
                if (customAmountInput) {
                    customAmountInput.addEventListener('input', (e) => {
                        const value = parseInt(e.target.value);
                        if (!isNaN(value) && value > 0) {
                            this.selectedAmount = value;
                            this.updateAmountButtons();
                        }
                    });
                }
            }
            
            selectPayment(method) {
                this.selectedPayment = method;
                this.updatePaymentUI();
            }
            
            selectAmount(amount) {
                this.selectedAmount = amount;
                const customAmountInput = document.getElementById('customAmount');
                if (customAmountInput) {
                    customAmountInput.value = amount;
                }
                this.updateAmountButtons();
            }
            
            updatePaymentUI() {
                document.querySelectorAll('.payment-option').forEach(el => {
                    el.classList.remove('selected');
                });
                
                const selectedOption = document.querySelector(`[onclick="selectPayment('${this.selectedPayment}')"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }
                
                this.updateAmountButtons();
            }
            
            updateAmountButtons() {
                document.querySelectorAll('.amount-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                const selectedBtn = document.querySelector(`[onclick="selectAmount(${this.selectedAmount})"]`);
                if (selectedBtn) {
                    selectedBtn.classList.add('selected');
                }
            }
            
            startPayment() {
                const customAmountInput = document.getElementById('customAmount');
                const customAmount = customAmountInput ? parseInt(customAmountInput.value) : this.selectedAmount;
                const amount = customAmount || this.selectedAmount;
                
                if (amount < CONFIG.MIN_TOPUP_AMOUNT || amount > CONFIG.MAX_TOPUP_AMOUNT) {
                    game.showNotification(`–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç ${CONFIG.MIN_TOPUP_AMOUNT} –¥–æ ${CONFIG.MAX_TOPUP_AMOUNT} ‚≠ê`, 'error');
                    return;
                }
                
                this.currentPaymentId = `payment_${game.userId}_${Date.now()}_${Math.random().toString(36).substring(2, 11)}`;
                
                if (this.selectedPayment === 'stars') {
                    this.processStarsPayment(amount);
                } else if (this.selectedPayment === 'ton') {
                    this.processTonPayment(amount);
                }
            }
            
            processStarsPayment(amount) {
                const content = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em; margin-bottom: 16px;">‚≠ê</div>
                        <h3 style="color: #1a1d29; margin-bottom: 8px;">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Telegram Stars</h3>
                    </div>
                    
                    <div class="payment-info">
                        <h4>üìã –î–µ–º–æ-—Ä–µ–∂–∏–º</h4>
                        <div style="display: grid; gap: 8px; margin: 16px 0;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</span>
                                <strong style="color: #f59e0b;">${amount} ‚≠ê</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:</span>
                                <strong>${game.balance} ‚≠ê</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:</span>
                                <strong style="color: #10b981;">${game.balance + amount} ‚≠ê</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: #f8fafc; padding: 16px; border-radius: 12px; margin: 16px 0;">
                        <p style="color: #6b7280; font-size: 0.9em;">
                            ‚ö° –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ Telegram Stars –¥–ª—è –æ–ø–ª–∞—Ç—ã
                        </p>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn" onclick="paymentSystem.completePayment(${amount})">
                            ‚úÖ –î–µ–º–æ-–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
                        </button>
                        <button class="btn btn-secondary" onclick="paymentSystem.closePaymentModal()">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                `;
                
                this.showPaymentModal('‚≠ê –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Stars', content);
            }
            
            processTonPayment(amount) {
                const tonAmount = (amount / CONFIG.PAYMENT_METHODS.TON.rate).toFixed(3);
                const paymentAddress = CONFIG.PAYMENT_ADDRESSES.TON;
                
                const content = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 3em; margin-bottom: 16px;">‚ö°</div>
                        <h3 style="color: #1a1d29; margin-bottom: 8px;">–û–ø–ª–∞—Ç–∞ TON</h3>
                    </div>
                    
                    <div class="payment-info">
                        <h4>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–ø–ª–∞—Ç–µ</h4>
                        <div style="display: grid; gap: 8px; margin: 16px 0;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>–°—É–º–º–∞:</span>
                                <strong>${tonAmount} TON</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>–ö—É—Ä—Å:</span>
                                <strong>1 TON = 150 ‚≠ê</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>–ü–æ–ª—É—á–∏—Ç–µ:</span>
                                <strong style="color: #f59e0b;">${amount} ‚≠ê</strong>
                            </div>
                        </div>
                    </div>
                    
                    <div class="payment-info">
                        <p><strong>–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ ${tonAmount} TON –Ω–∞ –∫–æ—à–µ–ª–µ–∫:</strong></p>
                        <div class="address-box">${paymentAddress}</div>
                        <p style="margin-top: 12px;"><strong>–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à ID:</strong></p>
                        <div class="address-box">${game.userId}</div>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin: 16px 0;">
                        <p style="color: #92400e; font-size: 0.9em;">
                            üí° –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –Ω–∞–∂–º–∏—Ç–µ "–Ø –æ–ø–ª–∞—Ç–∏–ª" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                        </p>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn" onclick="paymentSystem.completePayment(${amount})">
                            ‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª, –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
                        </button>
                        <button class="btn btn-secondary" onclick="paymentSystem.closePaymentModal()">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                `;
                
                this.showPaymentModal('‚ö° –û–ø–ª–∞—Ç–∞ TON', content);
            }
            
            completePayment(amount) {
                const parsedAmount = parseInt(amount);
                
                if (isNaN(parsedAmount) || parsedAmount < CONFIG.MIN_TOPUP_AMOUNT) {
                    game.showNotification('–ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞', 'error');
                    return;
                }
                
                game.balance += parsedAmount;
                game.stats.totalTransactions++;
                
                game.saveGameData();
                game.updateBalance();
                game.calculateStats();
                
                game.closeModal('paymentModal');
                game.showNotification(`‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${parsedAmount} ‚≠ê!`);
            }
            
            showPaymentModal(title, content) {
                document.getElementById('paymentTitle').textContent = title;
                document.getElementById('paymentContent').innerHTML = content;
                game.showModal('paymentModal');
            }
            
            closePaymentModal() {
                game.closeModal('paymentModal');
            }
        }

        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –§–£–ù–ö–¶–ò–ò
        let game;
        let paymentSystem;
        window.currentSellCoin = null;
        window.currentSellIndex = null;

        // –ó–ê–ü–£–°–ö –ò–ì–†–´
        document.addEventListener('DOMContentLoaded', function() {
            game = new GameEngine();
            paymentSystem = new PaymentSystem();
            
            setTimeout(() => {
                document.querySelector('.payment-option').classList.add('selected');
                document.querySelector('.amount-btn:nth-child(3)').classList.add('selected');
            }, 100);
        });

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø HTML
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionId === 'marketplace') {
                game.loadMarketplace().then(() => {
                    game.renderMarketplace();
                    game.updateMarketStats();
                });
            } else if (sectionId === 'stats') {
                game.calculateStats();
                game.updateMarketStats();
            }
        }

        function showCoinInfo(coinId) {
            const coin = CONFIG.COINS.find(c => c.id === coinId);
            if (!coin) return;
            
            const rarityInfo = game.getRarityInfo(coin.rarity);
            const owned = game.collection.some(c => c.id === coinId);
            
            const content = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 4em; margin-bottom: 16px;">${coin.icon}</div>
                    <h3 style="color: #1a1d29; margin-bottom: 8px;">${coin.name}</h3>
                    <div class="coin-rarity rarity-${coin.rarity}" style="margin-bottom: 12px;">
                        ${rarityInfo.name}
                    </div>
                    <p style="color: #6b7280; margin-bottom: 16px;">${coin.description}</p>
                    <div style="background: #f8fafc; padding: 16px; border-radius: 12px; margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>–ò–∑–¥–∞–Ω–∏–µ:</span>
                            <strong>${coin.edition}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span>–¶–µ–Ω–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ:</span>
                            <strong style="color: #f59e0b;">${coin.price} ‚≠ê</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>–í –≤–∞—à–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏:</span>
                            <strong>${owned ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç'}</strong>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    ${!owned ? `
                        <button class="btn" onclick="buyCoin(${coin.id}); closeModal('coinInfoModal')">
                            –ö—É–ø–∏—Ç—å –∑–∞ ${coin.price} ‚≠ê
                        </button>
                    ` : `
                        <button class="btn" onclick="showSection('collection'); closeModal('coinInfoModal')">
                            üì¶ –ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
                        </button>
                    `}
                    <button class="btn btn-secondary" onclick="closeModal('coinInfoModal')">
                        –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            `;
            
            const modalContent = `
                <div class="modal-content">
                    <h3>${coin.name}</h3>
                    ${content}
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = modalContent;
            modal.onclick = function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            document.body.appendChild(modal);
        }

        function buyCoin(coinId) {
            game.buyCoin(coinId);
        }

        function sellCoin(collectionIndex) {
            game.sellCoin(collectionIndex);
        }

        function confirmSell() {
            game.confirmSell();
        }

        function buyFromMarketplace(globalId) {
            game.buyFromMarketplace(globalId);
        }

        function cancelSale(globalId) {
            game.cancelSale(globalId);
        }

        function selectPayment(method) {
            paymentSystem.selectPayment(method);
        }

        function selectAmount(amount) {
            paymentSystem.selectAmount(amount);
        }

        function startPayment() {
            paymentSystem.startPayment();
        }

        function closeModal(modalId) {
            game.closeModal(modalId);
        }

        // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
        window.game = game;
        window.paymentSystem = paymentSystem;
    </script>
</body>
</html>